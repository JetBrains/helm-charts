# Kubernetes stateful Chart

`kubernetes-stateful-chart` is a generic Helm chart to use for the packaging of any stateful Kubernetes application.

## How to use this chart

This chart is formatted as an OCI package. Include it as a dependency from `https://public.jetbrains.space/p/helm/packages/container/library`.

Add it to your Chart.yaml file of your Helm package.

```yaml
dependencies:
  - name: kubernetes-stateful-chart
    repository: oci://public.registry.jetbrains.space/p/helm/library
    version: 1.x.x
    alias: app
```

## Repository

Checkout the [release.json](release.json) for details about where the chart is hosted.

## Prerequisites

- Kubernetes 1.24+;

- Helm 3+.

## Parameters

### Global parameters

| Name                      | Description                                                    | Value |
| ------------------------- | -------------------------------------------------------------- | ----- |
| `global.imageRegistry`    | Specify the registry that stores the images                    | `""`  |
| `global.imagePullSecrets` | Specify the credentials as secret names for pulling the images | `[]`  |

### Common parameters

| Name                | Description                                                                                     | Value |
| ------------------- | ----------------------------------------------------------------------------------------------- | ----- |
| `nameOverride`      | Provide a prefix to partially override the lib.name in the templates                            | `""`  |
| `fullnameOverride`  | Provide a name to override completely the lib.name in the templates                             | `""`  |
| `commonLabels`      | Provide a map of key/value pairs of labels to be applied to all resources in the templates      | `{}`  |
| `commonAnnotations` | Provide a map of key/value pairs of annotations to be applied to all resources in the templates | `{}`  |
| `namespaceOverride` | Provide a name to fully override lib.namespace in the templates                                 | `""`  |

### Application parameters

| Name                                                | Description                                                                                                                                                                                                                                                                                | Value                    |
| --------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------ |
| `include`                                           | Includes/Excludes the configurations for this application                                                                                                                                                                                                                                  | `true`                   |
| `name`                                              | Application name                                                                                                                                                                                                                                                                           | `""`                     |
| `image.registry`                                    | URL of the container registry                                                                                                                                                                                                                                                              | `quay.io`                |
| `image.repository`                                  | URL of the container repository                                                                                                                                                                                                                                                            | `jetbrains/run-forever`  |
| `image.tag`                                         | Image version                                                                                                                                                                                                                                                                              | `v0.1.0`                 |
| `image.pullPolicy`                                  | Pull policy of the container image                                                                                                                                                                                                                                                         | `Always`                 |
| `image.pullSecrets`                                 | Registry credentials. Specify not the credentials but the corresponding secrets                                                                                                                                                                                                            | `[]`                     |
| `entrypoint`                                        | Provide arguments to the entrypoint of the application.                                                                                                                                                                                                                                    | `[]`                     |
| `customEntrypoint`                                  | Overwrite in full the parameter entrypoint.                                                                                                                                                                                                                                                | `[]`                     |
| `args`                                              | Provide arguments to the entrypoint of the application.                                                                                                                                                                                                                                    | `[]`                     |
| `customArgs`                                        | Overwrite in full the parameter args.                                                                                                                                                                                                                                                      | `[]`                     |
| `serviceAccount.create`                             | Specify whether to create a service account                                                                                                                                                                                                                                                | `false`                  |
| `serviceAccount.name`                               | Service account name                                                                                                                                                                                                                                                                       | `""`                     |
| `serviceAccount.automountServiceAccountToken`       | Specify if the account can mount the access token from the Kubernetes API                                                                                                                                                                                                                  | `true`                   |
| `serviceAccount.labels`                             | Key/value map of labels                                                                                                                                                                                                                                                                    | `{}`                     |
| `serviceAccount.additionalLabels`                   | Additional key/value map of labels                                                                                                                                                                                                                                                         | `{}`                     |
| `serviceAccount.annotations`                        | Key/value map of annotations                                                                                                                                                                                                                                                               | `{}`                     |
| `serviceAccount.additionalAnnotations`              | Additional key/value map of annotations                                                                                                                                                                                                                                                    | `{}`                     |
| `serviceAccount.namespacePermissions`               | List of permissions to attach to the ServiceAccount within the in use namespace                                                                                                                                                                                                            | `[]`                     |
| `serviceAccount.additionalNamespacePermissions`     | Additional list of permissions to attach to the ServiceAccount within the in use namespace                                                                                                                                                                                                 | `[]`                     |
| `serviceAccount.clusterPermissions`                 | List of permissions to attach to the ServiceAccount within the in use Kubernetes cluster                                                                                                                                                                                                   | `[]`                     |
| `serviceAccount.additionalClusterPermissions`       | Additional list of permissions to attach to the ServiceAccount within the in use Kubernetes cluster                                                                                                                                                                                        | `[]`                     |
| `autoscaling.enabled`                               | Enables/disables autoscaling                                                                                                                                                                                                                                                               | `false`                  |
| `autoscaling.minReplicas`                           | Minimum number of pods                                                                                                                                                                                                                                                                     | `1`                      |
| `autoscaling.maxReplicas`                           | Maximum number of pods                                                                                                                                                                                                                                                                     | `5`                      |
| `autoscaling.metrics.targetCPU`                     | CPU utilization threshold                                                                                                                                                                                                                                                                  | `""`                     |
| `autoscaling.metrics.targetMemory`                  | Memory utilization threshold                                                                                                                                                                                                                                                               | `""`                     |
| `replicaCount`                                      | Initial number of pods for the application                                                                                                                                                                                                                                                 | `1`                      |
| `minReadySeconds`                                   | Specify the minimum number of seconds for which a newly created pod should be ready without any of its container crashing, for it to be considered available                                                                                                                               | `0`                      |
| `podManagementPolicy`                               | Specify how pods are created during initial scale up, when replacing pods on nodes, or when scaling down. Possible values are OrderedReady or Parallel.                                                                                                                                    | `OrderedReady`           |
| `revisionHistoryLimit`                              | Specify the number of old ReplicaSets to retain to allow rollback. This is a pointer to distinguish between explicit zero and not specified                                                                                                                                                | `10`                     |
| `updateStrategy.type`                               | Specify the type of the update strategy                                                                                                                                                                                                                                                    | `RollingUpdate`          |
| `updateStrategy.properties.maxUnavailable`          | Specify the maximum number of pods that can be unavailable during the update                                                                                                                                                                                                               | `1`                      |
| `updateStrategy.properties.partition`               | Specify the ordinal at which the StatefulSet should be partitioned for updates. During a rolling update, all pods from ordinal Replicas-1 to Partition are updated. All pods from ordinal Partition-1 to 0 remain untouched. This is helpful in being able to do a canary-based deployment | `0`                      |
| `podLabels`                                         | Specify labels to apply at PodSpec level                                                                                                                                                                                                                                                   | `{}`                     |
| `additionalPodLabels`                               | Additional labels to apply at PodSpec level                                                                                                                                                                                                                                                | `{}`                     |
| `podAnnotations`                                    | Specify annotations to apply at PodSpec level                                                                                                                                                                                                                                              | `{}`                     |
| `additionalPodAnnotations`                          | Additional annotations to apply at PodSpec level                                                                                                                                                                                                                                           | `{}`                     |
| `resources.requests.cpu`                            | Max CPU available for a pod (resource request)                                                                                                                                                                                                                                             | `100m`                   |
| `resources.requests.memory`                         | Max memory available for a pod (resource request)                                                                                                                                                                                                                                          | `128Mi`                  |
| `resources.limits.cpu`                              | Min CPU available for a pod (resource limit)                                                                                                                                                                                                                                               | `100m`                   |
| `resources.limits.memory`                           | Min memory available for a pod (resource limit)                                                                                                                                                                                                                                            | `128Mi`                  |
| `service.name`                                      | Service name                                                                                                                                                                                                                                                                               | `""`                     |
| `service.ports`                                     | Service ports                                                                                                                                                                                                                                                                              | `[]`                     |
| `service.additionalPorts`                           | Additional service ports                                                                                                                                                                                                                                                                   | `[]`                     |
| `service.type`                                      | Service type. Valid values are: ClusterIP, NodePort, LoadBalancer                                                                                                                                                                                                                          | `""`                     |
| `service.annotations`                               | Service annotations                                                                                                                                                                                                                                                                        | `{}`                     |
| `service.additionalAnnotations`                     | Additional service annotations                                                                                                                                                                                                                                                             | `{}`                     |
| `service.labels`                                    | Service labels                                                                                                                                                                                                                                                                             | `{}`                     |
| `service.additionalLabels`                          | Additional service labels                                                                                                                                                                                                                                                                  | `{}`                     |
| `podSecurityContext.fsGroup`                        | Group ID that has access to the filesystem at run-time                                                                                                                                                                                                                                     | `10001`                  |
| `containerSecurityContext.runAsUser`                | ID of the user who runs the process                                                                                                                                                                                                                                                        | `10001`                  |
| `containerSecurityContext.runAsNonRoot`             | Specify if the process can run under the root user                                                                                                                                                                                                                                         | `true`                   |
| `containerSecurityContext.allowPrivilegeEscalation` | Specify if the process can get more permissions at run-time                                                                                                                                                                                                                                | `false`                  |
| `containerSecurityContext.readOnlyRootFilesystem`   | Specify if the root filesystem of the process is read-only                                                                                                                                                                                                                                 | `true`                   |
| `customContainerSecurityContext`                    | Overwrite partially the containerSecurityContext property                                                                                                                                                                                                                                  | `{}`                     |
| `lifecycle`                                         | Actions that the management system should take in response to container lifecycle events.                                                                                                                                                                                                  | `{}`                     |
| `terminationGracePeriodSeconds`                     | Grace period to allow the write to shutdown before it is killed.                                                                                                                                                                                                                           | `30`                     |
| `livenessProbe`                                     | Specify the default liveness probe                                                                                                                                                                                                                                                         | `{}`                     |
| `customLivenessProbe`                               | Overwrite partially the livenessProbe property                                                                                                                                                                                                                                             | `{}`                     |
| `readinessProbe`                                    | Specify the default readiness probe                                                                                                                                                                                                                                                        | `{}`                     |
| `customReadinessProbe`                              | Overwrite partially the readinessProbe property                                                                                                                                                                                                                                            | `{}`                     |
| `startupProbe`                                      | Specify the default startup probe                                                                                                                                                                                                                                                          | `{}`                     |
| `customStartupProbe`                                | Overwrite partially the startupProbe property                                                                                                                                                                                                                                              | `{}`                     |
| `customAffinity`                                    | Overwrite in full the default affinity rules                                                                                                                                                                                                                                               | `{}`                     |
| `nodeName`                                          | Specify the NodeName where to schedule a pod. Leave empty for auto scheduling decision                                                                                                                                                                                                     | `""`                     |
| `nodeSelector`                                      | Specify the selector which must be true for the pod to fit on a node                                                                                                                                                                                                                       | `{}`                     |
| `ingress.enabled`                                   | Enables/disables Ingress for routing inbound traffic                                                                                                                                                                                                                                       | `false`                  |
| `ingress.name`                                      | Ingress name                                                                                                                                                                                                                                                                               | `""`                     |
| `ingress.pathType`                                  | Ingress path type                                                                                                                                                                                                                                                                          | `ImplementationSpecific` |
| `ingress.hostname`                                  | Ingress hostname                                                                                                                                                                                                                                                                           | `""`                     |
| `ingress.tls`                                       | Enables/disables TLS for the hostname                                                                                                                                                                                                                                                      | `false`                  |
| `ingress.alternateDnsNames`                         | Specify whether to add a list of alternative DNS names to the self-signed certificate                                                                                                                                                                                                      | `[]`                     |
| `ingress.certValidityDuration`                      | Specify how many days the self-signed certificate should remain valid                                                                                                                                                                                                                      | `""`                     |
| `ingress.path`                                      | Ingress path array                                                                                                                                                                                                                                                                         | `/`                      |
| `ingress.additionalPaths`                           | Ingress extra paths                                                                                                                                                                                                                                                                        | `[]`                     |
| `ingress.additionalTLS`                             | Additional TLS configuration                                                                                                                                                                                                                                                               | `[]`                     |
| `ingress.secret`                                    | Name of the external secret for $parent.hostname                                                                                                                                                                                                                                           | `""`                     |
| `ingress.ingressClassName`                          | IngressClass name                                                                                                                                                                                                                                                                          | `""`                     |
| `ingress.additionalRules`                           | Additional Ingress rules                                                                                                                                                                                                                                                                   | `[]`                     |
| `ingress.backendService.portName`                   | Specify the application port name of the backend service                                                                                                                                                                                                                                   | `http`                   |
| `ingress.annotations`                               | Key/value map with annotations                                                                                                                                                                                                                                                             | `{}`                     |
| `ingress.additionalAnnotations`                     | Additional key/value map with annotations                                                                                                                                                                                                                                                  | `{}`                     |
| `ingress.labels`                                    | Key/value map with labels                                                                                                                                                                                                                                                                  | `{}`                     |
| `ingress.additionalLabels`                          | Additional key/value map with labels                                                                                                                                                                                                                                                       | `{}`                     |
| `ports`                                             | Specify a list of application ports                                                                                                                                                                                                                                                        | `[]`                     |
| `volumes`                                           | Specify named volumes to be attached to the pod                                                                                                                                                                                                                                            | `[]`                     |
| `additionalVolumes`                                 | Specify additional mutual exclusive with volumes value named volumes to be attached to the main container and pod                                                                                                                                                                          | `[]`                     |
| `volumeClaims`                                      | Specify a list of volume claims to be attached to the pod                                                                                                                                                                                                                                  | `[]`                     |
| `additionalVolumeClaims`                            |                                                                                                                                                                                                                                                                                            | `[]`                     |
| `sidecars`                                          | Specify containers to run alongside the main container                                                                                                                                                                                                                                     | `[]`                     |
| `additionalSidecars`                                | Specify additional containers to run alongside the main container                                                                                                                                                                                                                          | `[]`                     |
| `initContainers`                                    | Specify a list of initialization containers belonging to the pod                                                                                                                                                                                                                           | `[]`                     |
| `additionalInitContainers`                          | Specify a list of additional initialization containers belonging to the pod                                                                                                                                                                                                                | `[]`                     |

### Application configuration file

| Name                         | Description                                                                              | Value |
| ---------------------------- | ---------------------------------------------------------------------------------------- | ----- |
| `config`                     | Overwrites the configuration in defaultConfig.config                                     | `""`  |
| `defaultConfig.name`         | Specify the default application configuration file name                                  | `""`  |
| `defaultConfig.mountPath`    | Specify the default application configuration file system path where the file is located | `""`  |
| `defaultConfig.config`       | Specify the default application configuration                                            | `""`  |
| `defaultConfig.customValues` | Specify a map of custom values to be referenced by the defaultConfig.config parameter    | `{}`  |
| `additionalConfigs`          | Specify additional configuration files to be added to the application                    | `{}`  |

### Application environment variables

| Name                           | Description                                                                                     | Value |
| ------------------------------ | ----------------------------------------------------------------------------------------------- | ----- |
| `envs`                         | Environment variables                                                                           | `{}`  |
| `additionalEnvs`               | Additional environment variables                                                                | `{}`  |
| `internalEnvSecret`            | Specify the internal secret name that contains system environment variables                     | `""`  |
| `externalEnvSecret`            | Specify the external secret name that contains system environment variables                     | `""`  |
| `additionalExternalEnvSecrets` | Specify additional external secrets' names as strings that contain system environment variables | `[]`  |

### Application Kubernetes resources

| Name                                | Description                                                         | Value |
| ----------------------------------- | ------------------------------------------------------------------- | ----- |
| `kubernetesYamlResources`           | Kubernetes objects to add to the application package                | `[]`  |
| `additionalKubernetesYamlResources` | Add additional Kubernetes objects to add to the application package | `[]`  |
